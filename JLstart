#!/bin/bash
cd "$(dirname "$BASH_SOURCE")"

export JLdir=/usr/local/JLIVECD
cd $JLdir
set -a
. ./defconf.sh
. ./funcs.sh
. "$JL_configfile"
set +a
mkdir -p "$JL_logdirtmp"

help="
******** JLstart ********
Usage:
    -ub       ubuntu mode
    -db       debian mode
    -al       archlinux mode
    -h        help menu
    -v        version info
See JLopt -h for settings.
"

live_os=
while [[ $# > 0 ]]
do
    case "$1" in
    	-ub|--ubuntu)
    		live_os=ubuntu
    		;;
        -db|--debian)
        	live_os=debian
            ;;
        -al|--archlinux)
            live_os=archlinux
            ;;
        -v|--version)
        	JLopt --version
        	exit 0
            ;;
        -h|--help)
            echo "$help"
            exit 0
            ;;
        *)
            echo "$help"
            echo "invalid option: '$1'"
            exit 1
        	;;
    esac
    shift
done

chknorm

#if live_os is not given, then force to select one:
if [ "$live_os" = "" ]; then
    echo
    echo "***************** MODE SELECT *****************"
    echo "* For Ubuntu family & Linux Mint: ubuntu mode *"
    echo "* For Debian:                     debian mode *"
    echo "* For archlinux:               archlinux mode *"
    echo "***********************************************"
	live_os=$(mode_select)
fi

if [ "$live_os" = archlinux ]; then
    JL_archlinux=true
    JL_squashfs="arch/$JL_arch/airootfs.sfs"
elif [ "$live_os" = debian ]; then
    JL_debian=true;
    JL_casper=live
    JL_squashfs="$JL_casper"/filesystem.squashfs
    JL_resolvconf=var/run/NetworkManager/resolv.conf #must not start with /
fi


JL_fresh=$(get_yn "Is this a new project: (y/n)?: ")

echo $JL_fresh > "$JL_ynF"

if [ "$JL_fresh" = y -o "$JL_fresh" = Y ]; then
  fresh_start
fi

if $JL_archlinux; then
    sudo ./main/custom_desktop -al
elif $JL_debian; then
    sudo  ./main/custom_desktop -db
else
    sudo  ./main/custom_desktop
fi
